from ALU import ALU
from nmigen.back.pysim import *
from CONSTS import ALU_FUNCS, DATA_TYPES
from Utils import to_formatted_hex

s: int = 0
f: int = 0
def alu_ut( alu: ALU, 
            func: ALU_FUNCS, 
            op1: str, 
            op2: str, 
            data_type: DATA_TYPES, 
            expected: str) -> Assign:
    global s, f

    yield alu.op1      .eq(int(op1, 16))
    yield alu.op2      .eq(int(op2, 16))
    yield alu.data_type.eq(data_type)
    yield alu.func     .eq(func)

    yield Settle()

    res = to_formatted_hex((yield alu.res))
    
    if res == expected:
        s += 1
    else:
        print(f'WRONG:\n{op1 = }\n{op2 = }\n{func = }\n{res = }\n{data_type = }\n{expected = }\n\n')
        f += 1


def alu_sh_test(alu: ALU) -> Assign:
    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00",
        "0",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00",
        "1",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_0B_0A",
        "4",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_10_B0_A0"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_04_02_01",
        "1",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_08_04_02"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_10_B0_A0",
        "4",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_10_B0_A0",
        "4",
        DATA_TYPES.pckd_w,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_00_0A_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_FC_10_0B_A0",
        "4",
        DATA_TYPES.pckd_w,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_C1_00_BA_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"FC_10_0B_AA",
        "10",
        DATA_TYPES.pckd_dw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"0B_AA_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"00_00_00_00_FC_10_0B_AA",
        "20",
        DATA_TYPES.pckd_qw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"FC_10_0B_AA_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHL, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"FC_10_0B_AA_00_00_00_00",
        "20",
        DATA_TYPES.pckd_qw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00",
        "0",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00",
        "1",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_0A_10_B0_A0",
        "4",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_0B_0A"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_04_02_01",
        "1",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_02_01_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_0B_0A",
        "4",
        DATA_TYPES.pckd_b,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_12_34_56_78",
        "4",
        DATA_TYPES.pckd_w,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_23_05_67"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_FC_10_0B_A0",
        "4",
        DATA_TYPES.pckd_w,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_0F_C1_00_BA"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"FC_10_0B_AA",
        "10",
        DATA_TYPES.pckd_dw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"00_00_FC_10"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"FC_10_0B_AA_00_00_00_00",
        "20",
        DATA_TYPES.pckd_qw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"00_00_00_00_FC_10_0B_AA"
    )

    yield from alu_ut(alu, ALU_FUNCS.SHR, 
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_"+"00_00_00_00_FC_10_0B_AA",
        "20",
        DATA_TYPES.pckd_qw,
        "00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00"
    )


def alu_moreless_test(alu: ALU) -> Assign:
    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_0B_0A_09_08_07_06_05_04_03_02_01_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_01_01_01_01_01_01_01_01_01_01',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_01_01_01_01_01_01_01_01_01_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_10_00_00_23_23_00_00_01', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_23_00_00_23_01_00',
        DATA_TYPES.pckd_w,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_00_00_00_01_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'01_00_00_00_'+'00_01_01_01_'+'00_10_00_00_'+'00_01_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_01_01_01_'+'01_00_00_00_'+'01_00_00_00_'+'00_00_01_00',
        DATA_TYPES.pckd_dw,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_00_00_01_'+'00_00_00_00_'+'00_00_00_00_'+'00_00_00_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'01_00_00_00_00_01_01_01_'+'00_10_00_00_00_01_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_01_01_01_01_00_00_00_'+'01_00_00_00_00_00_01_00',
        DATA_TYPES.pckd_qw,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_00_00_00_00_00_00_01_'+'00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.LESS,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.LESS,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_0B_0A_09_08_07_06_05_04_03_02_01_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_01_01_01_01_01_01_01_01_01_01',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.LESS,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_10_00_00_23_23_00_00_01', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_23_00_00_23_01_00',
        DATA_TYPES.pckd_w,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01_00_00_00_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.LESS,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'01_00_00_00_'+'00_01_01_01_'+'00_10_00_00_'+'00_01_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_01_01_01_'+'01_00_00_00_'+'01_00_00_00_'+'00_00_01_00',
        DATA_TYPES.pckd_dw,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_00_00_00_'+'00_00_00_01_'+'00_00_00_01_'+'00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.LESS,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'01_00_00_00_00_01_01_01_'+'00_10_00_00_00_01_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_01_01_01_01_00_00_00_'+'01_00_00_00_00_00_01_00',
        DATA_TYPES.pckd_qw,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_'+'00_00_00_00_00_00_00_00_'+'00_00_00_00_00_00_00_01'
    )


def alu_equal_test(alu: ALU) -> Assign:
    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00',
        DATA_TYPES.pckd_b,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01', 
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01',
        DATA_TYPES.pckd_b,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01',
        DATA_TYPES.pckd_b,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_01', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_02',
        DATA_TYPES.pckd_b,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF', 
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF',
        DATA_TYPES.pckd_b,
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF', 
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF',
        DATA_TYPES.pckd_w,
        '00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF', 
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF',
        DATA_TYPES.pckd_dw,
        '00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01'
    )

    yield from alu_ut(alu, ALU_FUNCS.EQ,
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF', 
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF',
        DATA_TYPES.pckd_qw,
        '00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01'
    )

    
def alu_addsub_test(alu: ALU) -> Assign:
    yield from alu_ut(alu, ALU_FUNCS.MORE,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.SUB,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00', 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00',
        DATA_TYPES.pckd_b,
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        '1',
        DATA_TYPES.pckd_b, 
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        'AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA_AA',
        '12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12_12',
        DATA_TYPES.pckd_b, 
        'BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC_BC'
    )
    yield from alu_ut(alu, ALU_FUNCS.ADD,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        '01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01_01',
        DATA_TYPES.pckd_b, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        '00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01',
        DATA_TYPES.pckd_w, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        '00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF_00_FF',
        '00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01',
        DATA_TYPES.pckd_w, 
        '01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00_01_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        '00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF_00_FF_FF_FF',
        '00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01',
        DATA_TYPES.pckd_dw, 
        '01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00_01_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.ADD,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        '00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01_00_00_00_00_00_00_00_01',
        DATA_TYPES.pckd_qw, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.SUB,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        DATA_TYPES.pckd_b, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.SUB, 
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        DATA_TYPES.pckd_w, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.SUB,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        DATA_TYPES.pckd_dw, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )

    yield from alu_ut(alu, ALU_FUNCS.SUB,
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        'FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF_FF',
        DATA_TYPES.pckd_qw, 
        '00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00_00'
    )


def alu_test(alu: ALU) -> Assign:
    global s, f

    yield from alu_moreless_test(alu)
    yield from alu_addsub_test(alu)
    yield from alu_equal_test(alu)
    yield from alu_sh_test(alu)
    
    print(f'{s = }\n{f = }')


def main():
    alu = ALU()

    sim = Simulator(alu)
    with sim.write_vcd(open('out.vcd', 'w')):
        sim.add_clock(1e-6)
        sim.add_sync_process(lambda: (yield from alu_test(alu)))
        sim.run()


if __name__ == '__main__':
    main()

